<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sentimental Gambit | AI Biometrics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <style>
        body { background-color: #050505; color: #00d4ff; font-family: 'Courier New', monospace; margin: 0; padding: 20px; text-align: center; }
        .main-container { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 20px; }
        .dashboard-box { border: 2px solid #00d4ff; border-radius: 8px; padding: 15px; background: rgba(0, 212, 255, 0.1); box-shadow: 0 0 20px rgba(0, 212, 255, 0.3); width: 520px; }
        .board { display: grid; grid-template-columns: repeat(8, 60px); grid-template-rows: repeat(8, 60px); border: 5px solid #333; margin: 0 auto; }
        .square { width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; font-size: 40px; cursor: pointer; }
        .white { background-color: #f0f0f0; color: #222; }
        .black { background-color: #00aaff; color: #fff; }
        .selected { background-color: #ff00ff !important; }
        .video-feed { width: 100%; border-radius: 4px; border: 1px solid #00d4ff; }
        .log-container { margin-top: 20px; width: 100%; max-width: 1080px; margin-left: auto; margin-right: auto; background: #000; border: 1px solid #0f0; padding: 10px; height: 100px; overflow-y: auto; color: #0f0; text-align: left; }
    </style>
</head>
<body>

    <h1>SENTIMENTAL GAMBIT: BIOMETRIC CHESS ANALYSIS</h1>
    <p style="color: #ff00ff;">USER: White | AI ENGINE: Black | STATUS: Monitoring Moods</p>

    <div class="main-container">
        <div class="dashboard-box">
            <h3>GAME INTERFACE</h3>
            <div id="board" class="board"></div>
            <p id="game-status" style="margin-top: 15px; font-weight: bold;">Your Turn</p>
        </div>

        <div class="dashboard-box">
            <h3>BIOMETRIC TELEMETRY</h3>
            <img src="{{ url_for('video_feed') }}" class="video-feed">
        </div>
    </div>

    <div class="log-container" id="log">[SYSTEM] Sentimental Gambit Initialized. Waiting for opening move...</div>

    <script>
        const game = new Chess();
        const boardElement = document.getElementById('board');
        const statusElement = document.getElementById('game-status');
        let selectedSquare = null;

        const pieceIcons = {
            'p': '♟', 'r': '♜', 'n': '♞', 'b': '♝', 'q': '♛', 'k': '♚',
            'P': '♙', 'R': '♖', 'N': '♘', 'B': '♗', 'Q': '♕', 'K': '♔'
        };

        function drawBoard() {
            boardElement.innerHTML = '';
            const board = game.board();
            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    const square = document.createElement('div');
                    const squareName = String.fromCharCode(97 + c) + (8 - r);
                    square.className = `square ${(r + c) % 2 === 0 ? 'white' : 'black'}`;
                    if (selectedSquare === squareName) square.classList.add('selected');
                    const piece = board[r][c];
                    if (piece) square.innerText = pieceIcons[piece.color === 'w' ? piece.type.toUpperCase() : piece.type];
                    square.onclick = () => handleSquareClick(squareName);
                    boardElement.appendChild(square);
                }
            }
        }

        function handleSquareClick(square) {
            if (game.game_over()) return;
            if (selectedSquare === null) {
                if (game.get(square) && game.get(square).color === 'w') {
                    selectedSquare = square;
                    drawBoard();
                }
            } else {
                const move = game.move({ from: selectedSquare, to: square, promotion: 'q' });
                selectedSquare = null;
                if (move) {
                    addLog(`User Move: ${move.san}.`);
                    drawBoard();
                    statusElement.innerText = "AI THINKING...";
                    setTimeout(makeComputerMove, 500);
                } else {
                    drawBoard();
                }
            }
        }

        function makeComputerMove() {
            const moves = game.moves();
            if (moves.length === 0) return;
            const move = moves[Math.floor(Math.random() * moves.length)];
            game.move(move);
            addLog(`AI Move: ${move}. Analyzing facial vectors...`);
            drawBoard();
            statusElement.innerText = game.game_over() ? "GAME OVER" : "Your Turn";
        }

        function addLog(text) {
            const log = document.getElementById('log');
            log.innerHTML += `[${new Date().toLocaleTimeString()}] ${text}<br>`;
            log.scrollTop = log.scrollHeight;
        }

        drawBoard();
    </script>
</body>
</html>